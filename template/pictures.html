<html>
  <head>
    <title>Steatite</title>
    <link rel="stylesheet" type="text/css" href="../stylesheet.css" />    
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript">

    function move() {
      var destination = $("#destination").val();
      var checked = $(":checked");
      var countdown = checked.size();
      checked.each(function() {
        var picture = $(this).closest(".picture");
        $.ajax({
          type: "POST",
          url: "../attributes.php?source_id=" + picture.attr("id")
            + "&attribute_name=corpus&attribute_value=" + destination,
          success: function() {
            countdown--;
            if (countdown<1) {
              location.reload();
            }
          }
        });
      });
    }

    $(document).ready(function() {
      resetUI();
    });

    function resetUI() {
      $("header>form").replaceWith(
        "<form>"
        + "<button type='button' onclick='showUpload()'>Upload...</button>"
        + "<button type='button' onclick='showMove()'>Move...</button>"
        + "</form>"
      );
      $("input[type='checkbox']").remove();
    }

    function showUpload() {
      $("header>form").replaceWith(
        "<form method='post' enctype='multipart/form-data'>"
        + "<input id='chooser' type='file' name='sources[]' multiple />"
        + "<button onclick='resetUI()' type='button'>Cancel</button>"
        + "<button type='submit'>Upload</button>"
        + "</form>"
      );
    }

    function showMove() {
      $("header>form").replaceWith(
        "<form>"
        + "<input type='text' id='destination' placeholder='Destination corpus' />"
        + "<button onclick='resetUI()' type='button'>Cancel</button>"
        + "<button type='button' onclick='move()'>Move</button>"
        + "</form>"
      );
      $(".picture>div").prepend("<input type='checkbox' />");
    }

    </script>
  </head>
  <body>
    <header>
      <nav>
        <a href='..'>Pictures</a> > 
        <span id="here">
          {{corpus}}
          {{^corpus}}Miscellanea{{/corpus}}
        </span>
      </nav>
      <form />
    </header>
    <form>
      {{#pictures}}
      <div id='{{id}}' class='picture'>
        <a href='{{id}}'><img src='../thumbnail/{{id}}' /></a>
        <div>
          <span>{{name}}</span>
        </div>
      </div>
      {{/pictures}}
    </form>
    <footer id="bottom" />
  </body>
</html>
